# Program B 仿真模拟器（Preview-PC）开发需求说明书

## 1. 项目背景
由于无法获取真实的 Review 软件（程序B）进行开发调试，需开发一套**高保真模拟器**。该软件需复刻真实程序的界面UI、按键交互逻辑及业务流程，并增加**测试控制面板**，用于人为制造“卡顿”、“缺图”、“弹窗”、“突然崩溃”等特殊场景，以验证 ARS 自动化脚本的鲁棒性。

---

## 模块一：界面与视图 (UI & View Modes)
### 功能描述
- **高保真UI复刻**：主界面需参照提供的截图（Preview.png），包含顶部状态栏、中间图像显示区、底部操作栏。
- **资源预加载**：支持从本地文件夹（可任意指定绝对路径，如 `D:\code\vscode_code\ARS_Preview-PC\test\images`）读取图片资源，循环用于模拟真实产品图。
- **双视图模式支持**：
  1.  **六宫格预览模式 (Grid Mode)**：界面显示 2x3 的六个小图框。
  2.  **单图放大模式 (Single View Mode)**：界面仅显示当前处理的一张大图（自动化实操主要场景）。
- **控制面板**：在主界面外或侧边栏提供一套“控制/测试按钮组”（Start, Pause, Stop, Mode Switch, Inject Faults）。

### 用户故事
作为**开发/测试人员**，我希望**模拟器能切换小图和大图两种显示模式**，从而**覆盖产线实际作业中可能遇到的不同界面状态**。

### 验收标准
- ✅ 启动程序读取本地图片成功，界面无花屏。
- ✅ 点击控制面板的“切换视图”，主界面能在“六宫格”和“单图放大”之间无缝切换。
- ✅ 界面元素的配色、字体、布局与真实截图（Screenshot_Jupiter.jpg）视觉差异 < 10%。

---

## 模块二：核心业务交互逻辑 (Core Logic)
### 功能描述
- **按键响应**：监听全局或窗口内的键盘事件：
  - 按下 `N` (OK)：标记当前图为OK，自动切换至下一张图。
  - 按下 `M` (NG)：标记当前图为NG，自动切换至下一张图。
- **批次流程**：
  - 逻辑：第1张 -> Key -> 第2张 ... -> 第6张 -> Key。
  - 结束动作：第6张处理完毕后，**必须**弹出一个模态窗口（Dialog），显示“确认提交”及“Confirm”按钮。
- **提交交互**：点击弹窗上的“Confirm”按钮后，弹窗消失，计数器重置，开始下一批次（第1张）。
- **流程控制**：
  - **暂停**：停止响应按键，画面冻结。
  - **开始**：恢复按键响应。

### 用户故事
作为**RPA开发人员**，我希望**模拟器对 N/M 按键的反应与真实软件一致（切图、翻页、弹窗）**，从而**验证我的自动化脚本能否正确控制流程**。

### 验收标准
- ✅ 在单图模式下，每按一次 N 或 M，图片内容更新为下一张。
- ✅ 连续处理完6张图片后，屏幕中央准确弹出“提交确认”窗口。
- ✅ 只有鼠标点击（或模拟点击）确认窗口按钮后，流程才能继续，否则卡在弹窗页。

---

## 模块三：异常场景注入 (Fault Injection)
### 功能描述
*本模块用于人为制造“混乱”，测试 ARS 脚本的抗干扰能力。*

- **场景 A：模拟缺料/等待 (Inject Wait)**
  - **功能**：点击测试按钮“模拟无图”，主显示区（或当前单图区）立即变为灰色背景，并显示 "Wait for capture" 字样。
  - **恢复**：再次点击或点击“恢复正常”，画面切回真实图片。
- **场景 B：模拟卡顿/无响应 (Inject Lag)**
  - **功能**：点击“模拟卡顿”，程序暂停响应任何键盘按键（N/M无效），持续 X 秒或需手动取消。
- **场景 C：模拟干扰弹窗 (Inject Popup)**
  - **功能**：点击“随机弹窗”，在界面非固定位置弹出一个无关的系统提示框（如“License Warning”），测试 ARS 是否被遮挡或误判。

### 用户故事
作为**测试工程师**，我希望**能手动强制程序进入“Wait for capture”状态**，从而**验证 ARS 脚本是否能正确识别该状态并停止操作，而不是对着灰色屏幕乱按**。

### 验收标准
- ✅ 点击“模拟无图”后，界面立即显示标准的灰色等待画面，且无论怎么按 N/M 均不切图。
- ✅ 处于“卡顿”模式时，连续按下键盘，界面图片应保持静止（验证脚本的超时逻辑）。

---

## 内部注意点 (Internal Notes)
1.  **图片资源**：请准备两组图片：一组为正常产品图，一组为带有 "Wait for capture" 文字的特制图（用于逻辑渲染，不仅仅是颜色填充）。
2.  **窗口标题**：模拟器的窗口标题（Window Title）必须与真实软件保持一致（如 `"Review PC for Jupiter Ver 1.3.4"`），以便测试 ARS 的句柄获取功能。
3.  **日志记录**：模拟器后台需打印 Log，记录收到的按键次数和时间戳，方便与 ARS 的发送日志进行对账（例如：ARS发了3次N，模拟器只收到了2次，排查丢包问题）。