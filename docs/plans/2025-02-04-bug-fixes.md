# Bug Fixes Plan

## Issues to Fix

### Issue 1: 批次数量循环设置
**问题**: 每批次数量固定，不支持循环变化
**需求**: 支持批次数量循环，如 1→2→3→1→2→3...
**文件**: `src/ui/main_window.py`
**修复**:
- 添加批次数量循环模式
- 在 `start_batch` 时根据批次号计算当前批次数量
- 模式: batch_count = (batch_num - 1) % 3 + 1 (1,2,3循环)

### Issue 2: 按键无反应 + 超时图片未替换
**问题**: N/M键不响应，超时后没有显示timeout图片
**文件**: `src/ui/main_window.py`
**修复**:
- 检查 `keyPressEvent` 是否正确调用 `key_handler.handle_key`
- 检查超时时是否正确调用 `show_timeout_image()`
- 确保 `_showing_wait` 标志正确设置

### Issue 3: 大图窗口报错
**问题**: `parent().parent().open_big_image(self)` 找不到方法
**文件**: `src/ui/grid_widget.py`
**修复**:
- 修改双击事件处理，使用信号机制而不是直接调用parent方法
- 已有 `image_clicked` 信号，正确触发即可

### Issue 4: 弹窗位置
**问题**: 干扰弹窗不在屏幕中间
**文件**: `src/injectors/popup_injector.py`
**修复**:
- 获取屏幕几何中心
- 将弹窗移动到屏幕中心

### Issue 5: Pause无法恢复
**问题**: 点击Pause后无法Resume
**文件**: `src/ui/main_window.py`
**修复**:
- 检查 `_on_pause_clicked` 实现
- 确保Pause按钮在暂停后变成Resume按钮

### Issue 6: 批次完成后按钮状态
**问题**: 批次完成后三个按钮都无法点击
**文件**: `src/ui/main_window.py`
**修复**:
- 检查 `_update_buttons` 逻辑
- 批次完成后应该可以点击Stop来重置

---

## Execution Order

1. Issue 3 (大图窗口) - 最简单，独立
2. Issue 4 (弹窗位置) - 简单，独立
3. Issue 2 (按键 + 超时) - 核心功能
4. Issue 5 (Pause/Resume) - 核心功能
5. Issue 6 (按钮状态) - UI逻辑
6. Issue 1 (批次循环) - 增强功能

---

## Test After Each Fix

- 启动应用
- 测试修复的功能
- 确认没有回归
